<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微博快照</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #searchBox, #dateFilter { margin: 10px; padding: 8px; font-size: 16px; }
        .snapshot-list { list-style: none; padding: 0; margin-top: 20px; }
        .snapshot-list li { margin: 5px 0; font-size: 18px; }
    </style>
</head>
<body>
    <h1>微博快照</h1>

    <input type="text" id="searchBox" placeholder="搜尋關鍵字">
    <input type="date" id="dateFilter">
    <ul id="snapshotList" class="snapshot-list"></ul>

    <script>
        const repoOwner = "lemonwater888"; // 你的 GitHub 使用者名稱
        const repoName = "570weibo"; // 你的倉庫名稱
        const snapshotsPath = "docs/snapshots"; // 存放快照的資料夾

        async function fetchSnapshots() {
            const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${snapshotsPath}`;
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error("無法取得快照列表");

                const files = await response.json();
                return files
                    .filter(file => file.name.endsWith(".html")) // 只篩選 .html 檔案
                    .map(file => file.name)
                    .sort((a, b) => b.localeCompare(a)); // 依日期排序
            } catch (error) {
                console.error("獲取快照失敗:", error);
                return [];
            }
        }

        async function loadSnapshots(filter = "") {
            const snapshots = await fetchSnapshots();
            const list = document.getElementById("snapshotList");
            list.innerHTML = ""; // 清空列表

            snapshots
                .filter(name => name.includes(filter)) // 依搜尋條件過濾
                .forEach(snapshot => {
                    const date = snapshot.replace(".html", ""); // 取得 YYYY-MM-DD 格式
                    const li = document.createElement("li");
                    li.innerHTML = `<a href="snapshots/${snapshot}" target="_blank">${date} 微博快照</a>`;
                    list.appendChild(li);
                });
        }

        // 監聽搜尋輸入
        document.getElementById("searchBox").addEventListener("input", (e) => {
            loadSnapshots(e.target.value);
        });

        // 監聽日期篩選
        document.getElementById("dateFilter").addEventListener("change", (e) => {
            loadSnapshots(e.target.value);
        });

        // 預設載入快照
        loadSnapshots();
    </script>
</body>
</html>
